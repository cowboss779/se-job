# 資料庫的 ACID 特性

ACID 是指資料庫管理系統（DBMS）在處理交易時應該具備的四個關鍵特性，以確保數據的正確性和可靠性。這四個特性分別是：

1. **Atomicity（原子性）**：
   - 交易中的所有操作要麼全部完成，要麼全部不完成。即使在系統發生故障的情況下，也不會出現部分完成的狀態。這保證了數據庫的數據不會因為部分更新而處於不一致的狀態。
   
2. **Consistency（一致性）**：
   - 交易在完成之前和之後，數據庫都應該處於一致的狀態。這意味著數據庫在執行交易之前遵循的所有約束，在交易完成後仍然得到滿足。
   
3. **Isolation（隔離性）**：
   - 多個同時進行的交易之間應該相互隔離，以避免它們的操作相互影響。這確保了在一個交易完成之前，不會看到它未提交的中間狀態。
   
4. **Durability（持久性）**：
   - 一旦交易提交，其結果應永久保存在數據庫中，即使系統崩潰也不會丟失。這意味著數據庫在交易提交後即使發生故障，數據仍然可以通過恢復機制保持一致。

這四個特性確保了資料庫在處理交易過程中的數據完整性和系統可靠性，是設計和實現可靠數據庫系統的基礎。

## 具體說明

1. **Atomicity（原子性）**：
   - 例如，在轉賬操作中，從一個賬戶扣款和向另一個賬戶存款是不可分割的操作，這兩者必須作為一個整體要麼一起成功，要麼一起失敗。
   
2. **Consistency（一致性）**：
   - 例如，在任何時刻，銀行系統中的每一筆交易都必須保持帳戶的總金額不變。

3. **Isolation（隔離性）**：
   - 例如，在處理多個併發交易時，使用鎖機制來保證每個交易的操作不被其他交易干擾。

4. **Durability（持久性）**：
   - 例如，使用日誌和備份機制來確保交易提交後的數據即使在系統崩潰後也能夠恢復。

這些特性共同確保了資料庫系統的穩定性和可靠性，並且是大多數關鍵應用程序的基本要求。

# RDBMS 通常通過以下方式來實現 ACID 特性

## 原子性（Atomicity）

使用事務日志（Transaction Log）來確保操作的原子性。如果一個事務未能完全執行，系統會回滾（Rollback）所有已經執行的操作。

## 一致性（Consistency）

應用數據庫約束（如外鍵、唯一性約束、檢查約束等）來確保數據的一致性。事務開始前和結束後，數據庫必須處於一致的狀態。

## 隔離性（Isolation）

通過鎖機制（如行鎖、表鎖）和隔離級別（如讀已提交、可重複讀、序列化）來確保事務的隔離性，不同的事務之間不會互相影響。

## 持久性（Durability）

使用持久性存儲（如磁盤存儲）和事務日志來確保數據在事務提交後不會丟失。即使在系統崩潰後，數據也可以通過事務日志恢復。

總之，RDBMS 通常通過嚴格的事務管理和數據保護機制來支持 ACID 特性，這使得它們非常適合需要高數據完整性和可靠性的應用場景。

# 隔離性（Isolation）

## 定義

隔離性（Isolation）是資料庫中的一個重要特性，確保多個併發事務在執行過程中互不干擾。這意味著一個事務的執行過程不會受到其他併發事務的影響，即每個事務的中間狀態對其他事務是不可見的。隔離性確保了事務在併發執行時的數據一致性。

## 隔離級別

資料庫系統通常提供多種隔離級別，來平衡隔離性和系統性能之間的關係。常見的隔離級別包括：

1. **讀未提交（Read Uncommitted）**：
   - 允許事務讀取其他事務未提交的數據。這種隔離級別最低，可能會導致髒讀（Dirty Read）。

2. **讀已提交（Read Committed）**：
   - 只允許事務讀取其他事務已提交的數據。這可以防止髒讀，但可能會導致不可重複讀（Non-repeatable Read）。

3. **可重複讀（Repeatable Read）**：
   - 保證在同一事務中多次讀取相同數據的結果是一致的，即事務在開始後不允許其他事務修改該數據。這可以防止髒讀和不可重複讀，但可能會導致幻讀（Phantom Read）。

4. **序列化（Serializable）**：
   - 最高的隔離級別，確保所有事務依序執行，完全避免髒讀、不可重複讀和幻讀，但會嚴重影響系統性能。

## 常見問題

在不同的隔離級別下，可能會出現以下問題：

1. **髒讀（Dirty Read）**：
   - 一個事務讀取到另一個事務未提交的數據，這些數據在後續可能被回滾。

2. **不可重複讀（Non-repeatable Read）**：
   - 一個事務在兩次讀取同一數據時，讀取到不同的數據值，因為另一個事務在兩次讀取之間修改了數據。

3. **幻讀（Phantom Read）**：
   - 一個事務在兩次查詢同一條件的數據集時，發現結果集中有新增或刪除的行，因為另一個事務在兩次查詢之間插入或刪除了數據。

## 實現方式

資料庫系統通過鎖機制來實現隔離性。常見的鎖包括：

1. **行鎖（Row Lock）**：
   - 鎖定單行數據，允許其他事務操作不同的行。

2. **表鎖（Table Lock）**：
   - 鎖定整個表，防止其他事務對該表的任何操作。

3. **共享鎖（Shared Lock）**：
   - 允許多個事務同時讀取，但不允許修改。

4. **排他鎖（Exclusive Lock）**：
   - 允許事務進行讀寫操作，並阻止其他事務同時讀寫。

總之，隔離性是資料庫系統的一個關鍵特性，通過不同的隔離級別和鎖機制，確保多個事務併發執行時數據的一致性和完整性。


# 一致性（Consistency）

## 定義

一致性（Consistency）是資料庫中的一個重要特性，確保任何事務將數據庫從一個一致的狀態轉換到另一個一致的狀態。這意味著在事務執行前後，數據庫必須遵守所有定義的規則、約束和觸發器。

## 重要性

一致性確保數據的完整性和準確性。這對於維護數據庫的正確性至關重要，因為它保證每個事務的執行不會違反數據庫的任何約束，並且所有數據變更都是有效的和預期的。

## 實現方式

1. **數據庫約束**：
   - **主鍵約束（Primary Key Constraint）**：保證每一行都有一個唯一的標識。
   - **外鍵約束（Foreign Key Constraint）**：保證引用的關聯數據存在，維護數據之間的參考完整性。
   - **唯一性約束（Unique Constraint）**：保證某一列的所有數值都不重複。
   - **檢查約束（Check Constraint）**：保證列中的數值符合特定的條件。

2. **觸發器（Triggers）**：
   - 自動執行的程序，用於強制數據庫規則，例如，在插入、更新或刪除數據時觸發相關操作，確保數據的一致性。

3. **預設值（Default Values）**：
   - 為列設置預設值，確保插入新數據時數據的完整性。

4. **存儲過程（Stored Procedures）**：
   - 將數據庫邏輯封裝在存儲過程中，確保數據操作符合業務規則，維護數據的一致性。

## 一致性示例

1. **銀行轉賬**：
   - 在轉賬操作中，一致性確保從一個帳戶扣款的同時，另一個帳戶的存款必須完成，否則整個操作應該回滾。這保證了總金額的一致性。

2. **庫存管理**：
   - 在庫存系統中，一致性確保每次商品進貨或銷售時，庫存數量和相關的財務數據必須正確更新，任何錯誤都應該被檢測並回滾。

## 總結

一致性是資料庫 ACID 特性中的一個關鍵組成部分，通過強制數據庫約束、觸發器、預設值和存儲過程來實現。它確保了數據庫在任何事務執行後都處於一個有效的狀態，從而保證數據的完整性和準確性。


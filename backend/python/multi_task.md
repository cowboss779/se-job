# python multi process/thread/corouthie


## CPU密集型任務時，可以使用多進程、多線程或單個線程來執行。這三種方法各有優缺點
### 單個線程 (Single Thread):
* 優點
  * 編程簡單，沒有同步問題
  * 不需要處理進程間通信。
* 缺點
  * 無法充分利用多核CPU，因為單個線程在任何時間點只能在一個CPU核心上執行。
### 多線程 (Multithreading):
* 優點
  * 對於I/O密集型任務（例如網絡請求或文件讀寫）有顯著的性能提升，因為它可以在I/O操作等待時切換線程繼續其他任務。
  * 相比多進程，線程間共享內存，通信成本低。
* 缺點
  * ython的GIL（全局解釋器鎖）限制了多線程在CPU密集型任務中的效果，因為同一時間只能有一個線程在執行Python字節碼。
  * 複雜的同步問題，可能會引發死鎖和競態條件。
### 多進程 (Multiprocessing)
* 優點
  * 能夠充分利用多核CPU，因為每個進程都有自己的Python解釋器和GIL，可以真正並行地執行CPU密集型任務。
  * 獨立的進程間不會共享內存，減少了同步問題。
* 缺點
  * 創建進程的開銷較大，尤其在Windows系統上
  * 進程間通信（IPC）相對複雜且開銷大（例如使用multiprocessing.Queue或multiprocessing.Pipe）。
### 協程 (Coroutines)
* 優點
  * 非常高效的I/O操作，因為協程幾乎沒有上下文切換的開銷
  * 可以處理大量的並發I/O操作，性能表現優越
  * 代碼相對簡潔，容易讀寫和維護
* 缺點
  * 不適合CPU密集型任務，因為它並不能真正並行執行計算任務
  * 需要重寫代碼以支持async/await語法


## 性能測試與比較
* 單個線程: 適合簡單的任務，不需要高性能。
* 多線程: 適合I/O密集型任務，受GIL限制，不建議用於CPU密集型任務。
* 多進程: 適合CPU密集型任務，可以充分利用多核CPU的性能。
* 協程: 非常適合I/O密集型任務，但不適合CPU密集型任務。

## 選擇建議
* I/O密集型任務: 使用協程或多線程來提高性能和響應速度。協程在大規模I/O操作時尤其高效。
* CPU密集型任務: 使用多進程來充分利用多核CPU，避免GIL的限制。

## I/O密集型任務的選擇
### 選擇協程
* 當需要處理大量並發I/O操作，並且可以使用支持異步的庫時，協程是更好的選擇。協程的低開銷和高效資源管理使其在處理大量I/O操作時性能優越。
* 如果有異步I/O就使用，異步I/O代表是跟async有相關的語法，python3.5後才引入的功能
### 選擇多線程
* 當現有代碼使用同步I/O操作且不希望重構代碼時，使用多線程是一種實際的選擇。
* 當需要處理的I/O操作不支持異步編程時，多線程是一個有效的替代方案。

### 結論
* 能用協程就用協程，程式裡不方便用協程就用多線程

## ref
* [进程，线程和协程 (Process, Thread and Coroutine)](https://leovan.me/cn/2021/04/process-thread-and-coroutine-python-implementation/)
# index

# 資料庫中的索引、B-Tree 和 B+ Tree

## 資料庫中的索引

資料庫索引是一種用來加速資料查詢的資料結構，類似於書本的目錄。透過建立索引，資料庫能夠更快地定位和存取所需的資料，而不需要遍歷整個表。常見的索引結構包括哈希索引和樹型索引，其中 B-Tree 和 B+ Tree 是最常用的樹型索引。

## 使用index會增加查詢效率的查詢
``` sql
/*
1.篩選查詢（SELECT ... WHERE）：
如果 department_id 列有索引，資料庫可以通過索引快速找到對應的記錄
當查詢包含篩選條件時，索引可以快速定位滿足條件的記錄
*/
SELECT * FROM employees WHERE department_id = 10;


/*
2.排序查詢（ORDER BY）：
如果查詢結果需要排序，索引可以加速排序操作。
如果 last_name 列有索引，資料庫可以利用索引中的排序順序直接生成有序結果。
*/
SELECT * FROM employees ORDER BY last_name;


/*
3. 範圍查詢（BETWEEN, >, <, >=, <=）：
對於範圍查詢，索引可以快速定位範圍內的記錄。
如果 sale_date 列有索引，資料庫可以快速找到範圍內的記錄。
*/
SELECT * FROM sales WHERE sale_date BETWEEN '2023-01-01' AND '2023-06-30';


/*
4. 聚合查詢（GROUP BY）：
索引可以加速基於某列的分組操作。
如果 department_id 列有索引，資料庫可以更高效地分組和計數。
*/
SELECT department_id, COUNT(*) FROM employees GROUP BY department_id;


/*
5. 聯合查詢（JOIN）
在多表聯合查詢中，索引可以加速匹配鍵值的查找。
如果 employees.department_id 和 departments.department_id 列有索引，資料庫可以更快地執行聯合操作。
*/
SELECT e.*, d.department_name 
FROM employees e
JOIN departments d ON e.department_id = d.department_id;


/*
唯一查詢（UNIQUE, DISTINCT）：
當查詢需要查找唯一值或消除重複值時，索引可以提高效率。
如果 last_name 列有索引，資料庫可以更快地查找唯一值。
*/
SELECT DISTINCT last_name FROM employees;

```

## 有index還是掃描整張的可能
* 查詢條件不適用索引，如 `SELECT * FROM employees WHERE UPPER(first_name) = 'JOHN';`
  * UPPER不使用索引
* 當表非常小時，資料庫可能會選擇直接掃描整個表，而不是使用索引，因為這樣反而更高效。
* 查詢大部分行
  * 當查詢結果包含表中的大部分行時，使用索引的優勢不明顯
  * 如 `SELECT * FROM employees WHERE salary > 1000;`


## index的缺點
* 增加存儲空間需求
* 插入、更新、刪除操作性能降低
* 複雜性增加
* 索引失效問題
* 建索引和重建索引的開銷
* 選擇不當的索引可能導致性能問題
  * 如欄位值的可能太少，如性別

## B-Tree

B-Tree 是一種自平衡的樹形結構，用於維持有序資料，允許高效的插入、刪除和查找操作。B-Tree 的特點如下：

1. **多路平衡樹**：B-Tree 是一種多路（多子節點）平衡樹，這意味著每個節點可以有多個子節點，而不是二元樹的兩個。
2. **自平衡**：B-Tree 自動保持平衡，確保樹的高度最小化，使得查找、插入和刪除操作的時間複雜度保持在 \(O(\log n)\)。
3. **節點包含多個鍵**：每個節點包含多個鍵（key）和指向子節點的指標，所有鍵按照順序排列。
4. **根節點到葉節點的路徑長度相同**：這確保了所有葉節點在同一層，從而平衡了樹的高度。

B-Tree 適用於文件系統和數據庫中的索引結構，因為它能夠高效地處理大量資料。

## B+ Tree

B+ Tree 是 B-Tree 的一種變體，並且在資料庫和文件系統中更為常用。它具有以下特點：

1. **所有值都在葉節點**：與 B-Tree 不同，B+ Tree 的所有數據值都存儲在葉節點中，而非內部節點。這樣可以使得所有葉節點形成一個有序的鏈表，方便範圍查詢。
2. **內部節點只存儲鍵**：內部節點僅用於導航，僅存儲鍵而不存儲實際數據值。這使得樹的高度更小，更加平衡。
3. **鏈表結構**：所有葉節點通過鏈表連接，這使得範圍查詢和順序訪問更加高效。
4. **查找效率更高**：由於 B+ Tree 的數據存儲在葉節點且內部節點只作為索引導航，查找操作效率更高，特別是對於範圍查詢。

B+ Tree 的這些特性使其在資料庫和文件系統的索引結構中得到了廣泛的應用。

## 總結

- **索引**：用於加速資料查詢的資料結構。
- **B-Tree**：多路自平衡樹，所有鍵和數據分佈在整個樹的節點中。
- **B+ Tree**：B-Tree 的變體，所有數據值存儲在葉節點，內部節點僅用於導航，適合範圍查詢。

這些索引結構的應用確保了資料庫能夠高效地處理大規模的數據查詢和維護操作。
